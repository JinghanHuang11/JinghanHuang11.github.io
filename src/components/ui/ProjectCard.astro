---
import type { Project } from '@/data/projects';
import type { Locale } from '@/i18n/ui';

interface Props {
  project: Project;
  locale: Locale;
}

const { project, locale } = Astro.props;

// Check if project has a custom cover image
const hasCustomCover = 'coverImage' in project && project.coverImage;

// Generate unique gradient colors based on project ID (fallback for projects without custom cover)
const projectId = project.id;
const gradients = {
  'default': {
    from: 'from-primary-400',
    via: 'via-purple-400',
    to: 'to-pink-500',
    darkFrom: 'dark:from-primary-900',
    darkVia: 'dark:via-purple-900',
    darkTo: 'dark:to-pink-950',
    accent: 'bg-primary-500',
    darkAccent: 'dark:bg-primary-400'
  }
};

const gradient = gradients.default;
---

<a
  href={project.demo || project.github || '#'}
  target="_blank"
  rel="noopener noreferrer"
  class="group card block overflow-hidden transition-all hover:-translate-y-1"
>
  {
    hasCustomCover ? (
      // Custom cover image
      <div class="aspect-video w-full overflow-hidden relative">
        <img
          src={project.coverImage as string}
          alt={project.title[locale]}
          class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
          loading="lazy"
        />
      </div>
    ) : (
      // CSS-generated gradient pattern
      <div class={`aspect-video w-full overflow-hidden bg-gradient-to-br ${gradient.from} ${gradient.via} ${gradient.to} ${gradient.darkFrom} ${gradient.darkVia} ${gradient.darkTo} relative`}>
        <!-- Decorative pattern -->
        <div class="absolute inset-0 opacity-20">
          <div class="absolute top-0 right-0 h-32 w-32 translate-x-8 -translate-y-8 rounded-full bg-white dark:bg-white/10"></div>
          <div class="absolute bottom-0 left-0 h-24 w-24 -translate-x-6 translate-y-6 rounded-full bg-white dark:bg-white/10"></div>
          <div class="absolute top-1/2 left-1/2 h-40 w-40 -translate-x-1/2 -translate-y-1/2 rounded-full bg-white dark:bg-white/5"></div>
        </div>

        <!-- Project acronym/icon -->
        <div class="absolute inset-0 flex items-center justify-center">
          <div class={`relative flex h-24 w-24 items-center justify-center rounded-2xl ${gradient.accent} ${gradient.darkAccent} text-4xl font-bold text-white shadow-2xl transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3`}>
            {project.title[locale].split(' ').map(word => word[0]).join('').slice(0, 3)}
          </div>
        </div>

        <!-- Gradient overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent dark:from-black/40"></div>
      </div>
    )
  }

  <div class="p-6">
    <h3 class="heading-tertiary mb-2">{project.title[locale]}</h3>

    <p class="text-body mb-4 line-clamp-2 text-sm">
      {project.description[locale]}
    </p>

    <div class="mb-4 flex flex-wrap gap-2">
      {project.tags.map((tag) => (
        <span class="rounded-full bg-primary-50 px-3 py-1 text-xs font-medium text-primary-700 dark:bg-primary-950 dark:text-primary-300">
          {tag}
        </span>
      ))}
    </div>

    <div class="flex items-center gap-2 text-sm font-medium text-primary-600 dark:text-primary-400">
      <span>{locale === 'en' ? 'View Details' : '查看详情'}</span>
      <svg class="h-4 w-4 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
      </svg>
    </div>
  </div>
</a>
